{% extends "jukeBoxApp/base.html" %}
{% load static %}
{% load i18n %}

{% block breadcumb_title %}{% trans "Sugerir Canción" %}{% endblock %}
{% block breadcumb_subtitle %}{% trans "Propon una canción para el catálogo" %}{% endblock %}
{% block breadcumb_style %}background-image: url({% static 'img/bg-img/breadcumb3.jpg' %});{% endblock %}

{% block content %}
<div class="container section-padding-100">
    <div class="row justify-content-center">
        <div class="col-12 col-md-8">
            <div class="card">
                <div class="card-body">
                    <h4 class="card-title">{% trans "Sugerir Canción" %}</h4>
                    <form method="post">
                        {% csrf_token %}

                        <div class="mb-3">
                            <strong>Título:</strong><br>
                            {{ form.titulo }}
                            {% for error in form.titulo.errors %}
                            <div class="text-danger">{{ error }}</div>
                            {% endfor %}
                        </div>

                        <div class="mb-3">
                            <strong>Artista:</strong><br>
                            {{ form.artista_selector }}
                            {% for error in form.artista_selector.errors %}
                            <div class="text-danger">{{ error }}</div>
                            {% endfor %}
                        </div>

                        <div class="mb-3 artista-otro-container" id="artista-otro-container">
                            <strong>Nombre del artista:</strong><br>
                            {{ form.artista_otro }}
                            {% for error in form.artista_otro.errors %}
                            <div class="text-danger">{{ error }}</div>
                            {% endfor %}
                        </div>

                        <div class="mb-3">
                            <strong>Enlace:</strong><br>
                            {{ form.enlace }}
                        </div>

                        <div class="mb-3">
                            <strong>Comentario:</strong><br>
                            {{ form.comentario }}
                        </div>
                        <button type="submit" class="btn btn-success">{% trans "Enviar sugerencia" %}</button>
                    </form>
                    <hr>
                    <p class="small text-muted mt-3">{% trans "Las sugerencias serán revisadas manualmente." %}</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Función para mostrar/ocultar el campo de artista personalizado
    function toggleArtistaOtro() {
        var selector = document.getElementById('id_artista_selector');
        var container = document.getElementById('artista-otro-container');
        var input = document.getElementById('id_artista_otro');

        if (selector && container && input) {
            if (selector.value === 'otro') {
                container.style.display = 'block';
                input.required = true;
            } else {
                container.style.display = 'none';
                input.required = false;
                input.value = '';
            }
        }
    }

    // Usar jQuery si está disponible, sino vanilla JS
    if (typeof jQuery !== 'undefined') {
        $(document).ready(function () {
            $('#id_artista_selector').change(toggleArtistaOtro);
            toggleArtistaOtro(); // Estado inicial

            // Add form-control class to other fields to match width
            $('#id_titulo, #id_enlace, #id_comentario, #id_artista_otro').addClass('form-control');
        });
    } else {
        // Vanilla JS fallback
        document.addEventListener('DOMContentLoaded', function () {
            var selector = document.getElementById('id_artista_selector');
            if (selector) {
                selector.addEventListener('change', toggleArtistaOtro);
                toggleArtistaOtro(); // Estado inicial
            }

            // Add form-control class to other fields to match width
            var fields = ['id_titulo', 'id_enlace', 'id_comentario', 'id_artista_otro'];
            fields.forEach(function (id) {
                var element = document.getElementById(id);
                if (element) {
                    element.classList.add('form-control');
                }
            });
        });
    }
</script>
{% endblock %}